window.onload=function(){function t(t){var i=2e-4,n=1;t.forEach(function(t){t.priorite=+t.priorite}),u.domain([0,d3.max(t,function(t){return t.priorite})]),v=d3.forceSimulation().velocityDecay(.04).force("y",d3.forceY().strength(i).y(n)).force("collide",d3.forceCollide().radius(function(t){return 1.08*t.radius}).iterations(2)).alphaDecay(.001).alphaTarget(.001).on("tick",a),v.stop(),m=t.map(function(t){var e=u(t.priorite);return{id:t.id,titre:t.titre,priorite:t.priorite,tags:t.tags,radius:e,x:e+Math.random()*(l-2*e),y:o}}),e(m),r(m)}function e(){g=f.selectAll("g").data(m,function(t){return t.id});{var t=g.enter().append("g").attr("class","bulle");t.append("image").attr("xlink:href","../img/bulle.svg").attr("width",0).attr("height",0).attr("x",function(t){t.x}).attr("y",function(t){t.y})}g=g.merge(t),d3.selectAll(".bulle").select("image").transition().duration(1500).attr("width",function(t){return console.log("d.radius"),t.radius*c*2}).attr("height",function(t){return t.radius*c*2}).attr("transform",function(t){var e=[-t.radius*c,-t.radius*c];return"translate("+e+")"}),v.nodes(m).restart()}function r(){console.log("hit"),g=h.selectAll("g").data(m,function(t){return t.id});var t=g.enter().append("g").attr("class","bulle"),e=t.append("circle").attr("fill","transparent").attr("class","hitzone").attr("r",0).attr("cx",function(t){t.x}).attr("cy",function(t){t.y});e.on("click",function(t,e){console.log(e),i(t.id,t)}),g=g.merge(t),d3.selectAll(".bulle").select("circle").transition().duration(1500).attr("r",function(t){return t.radius}),v.nodes(m).restart()}function i(t,e){if(n=!n){var r=1.5*Math.max(l,o);d3.select(".image").selectAll(".bulle").filter(function(e){return e.id===t}).select("image").transition().duration(1500).attr("width",r*c*2).attr("height",r*c*2).attr("transform",function(){var t=[-r*c,-r*c];return"translate("+t+")"}),d3.select(".hit").selectAll(".bulle").filter(function(e){return e.id===t}).select("circle").transition().duration(1500).attr("r",r),d3.select(".hit").selectAll(".bulle").filter(function(e){return e.id===t}).moveToFront(),d3.select(".image").selectAll(".bulle").filter(function(e){return e.id===t}).moveToFront(),setTimeout(function(){p.html("<div class='info'><h3>"+e.titre+"</h3><p>Tags: "+e.tags+"</p></div>"),console.log(e.id+" "+e.titre+" "+e.priorite)},800)}else d3.select(".image").selectAll(".bulle").filter(function(e){return e.id===t}).select("image").transition().duration(1e3).attr("width",function(t){return t.radius*c*2}).attr("height",function(t){return t.radius*c*2}).attr("transform",function(t){var e=[-t.radius*c,-t.radius*c];return"translate("+e+")"}),d3.select(".hit").selectAll(".bulle").filter(function(e){return e.id===t}).select("circle").transition().duration(1e3).attr("r",function(t){return t.radius}),p.html("&nbsp;")}function a(){var t=60;f.selectAll("image").attr("x",function(t){var e=1.1*u(t.priorite);return t.x=Math.max(e,Math.min(l-e,t.x))}).attr("y",function(e){var r=1.1*u(e.priorite);return e.y=Math.max(r+t,Math.min(o-r,e.y))}),h.selectAll("circle").attr("cx",function(e){var r=1.1*u(e.priorite);return e.x=Math.max(r+t,Math.min(l-r,e.x))}).attr("cy",function(t){var e=1.1*u(t.priorite);return t.y=Math.max(e,Math.min(o-e,t.y))})}var n=!1,l=$(window).width(),o=$(window).height()-d3.select("footer.main_footer").attr("height"),s=Math.sqrt(l*o/24),c=1.35,u=d3.scaleLinear().range([0,s]),d=(d3.scaleOrdinal(d3.schemeCategory10),d3.select("#data-figure").append("figure").attr("class",".svgbulle").append("svg").attr("width",l).attr("height",o)),f=d.append("g").attr("class","image"),h=d.append("g").attr("class","hit"),p=d3.select("#data-figure figure").append("section").attr("class","bulle-details");d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)})},d3.json("data/films.json",function(e,r){if(e)throw e;console.log(r),t(r)});var g,m,v;d3.selectAll(".filter").on("click",function(){var t=d3.select(this),e=t.attr("id");console.log(e),"all"==e||$("#"+e).hasClass("active")?($(".active").removeClass("active").addClass("inactive"),d.selectAll(".bulle").attr("display","inline"),$("#all").removeClass("inactive").addClass("active")):($(".active").removeClass("active").addClass("inactive"),$("#"+e).removeClass("inactive").addClass("active"),d.selectAll(".bulle").attr("display","none").filter(function(t){return t.tags.match(new RegExp(e))}).attr("display","inline"))})};